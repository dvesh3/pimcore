<VirtualHost *:8080>
  DocumentRoot %GITHUB_WORKSPACE_DIR%/web

  <FilesMatch \.php$>
      SetHandler "proxy:unix:/run/php/php7.3-fpm.sock|fcgi://localhost"
  </FilesMatch>

  <Directory "%GITHUB_WORKSPACE_DIR%/web">
      Options FollowSymLinks
      AllowOverride All
      Require all granted
      SetEnv HOME %GITHUB_WORKSPACE_DIR%/web
      SetEnv HTTP_HOME %GITHUB_WORKSPACE_DIR%/web
  </Directory>

  RewriteEngine On

  RewriteRule ".*" "-" [E=HTTP_AUTHORIZATION:%{HTTP:Authorization},L]

  CustomLog "%GITHUB_WORKSPACE_DIR%/apache-access.log" combined
  ErrorLog "%GITHUB_WORKSPACE_DIR%/apache-error.log"

  SetEnv PIMCORE_TEST 1
  SetEnv PIMCORE_ENVIRONMENT %PIMCORE_ENVIRONMENT%
  SetEnv PIMCORE_TEST_DB_DSN %PIMCORE_TEST_DB_DSN%
  SetEnv PIMCORE_TEST_CACHE_REDIS_DATABASE %PIMCORE_TEST_CACHE_REDIS_DATABASE%
</VirtualHost>
